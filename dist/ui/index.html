<!DOCTYPE html>
<html>
	<head>
		<style>
			@font-face {
				font-family: 'dollop_serifexpanded';
				src: url('font/dollopserif-expanded-webfont.woff2') format('woff2'),
					 url('font/dollopserif-expanded-webfont.woff') format('woff');
				font-weight: normal;
				font-style: normal;
			}
			@font-face {
				font-family: 'dollop_serifcondensed';
				src: url('font/dollopserif-condensed-webfont.woff2') format('woff2'),
					 url('font/dollopserif-condensed-webfont.woff') format('woff');
				font-weight: normal;
				font-style: normal;
			}
			* {
				margin:0;
				padding:0;
			}
			#marco {
				height: 100vh;
				width: 100vw;
				overflow:hidden;
			}
			@media (orientation: landscape) {
				#marco {
					margin:auto;
					position:relative;
					height: 100vh;
					width: auto;
					aspect-ratio: 1050 / 1920;
					max-width: 1080px;
					max-height: 1920px;
				}
			}
			
			.pantalla {
				position:absolute;
				top:0;
				left:0;
				width:100%;
				height:100%;
			}
			#juego {
				background:url('img/fondojuego.png') top center no-repeat #F1E3CD;
				background-size: 100% auto;			
			}
			#juego > div {
				width:100%;
				height:100vh;
				display:flex;
				justify-content:space-around;
				align-items: center;
				flex-direction:column;
				padding:2vh 2%;
				box-sizing:border-box;
			}
			#logojuego {
				height:10vh;
			}
			#juego p {
				font-size:2.2vh;
				text-align:center;
				font-family: 'dollop_serifexpanded';
				color:#004976;
			}
			#estantes {
				height:70vh;
				width:90%;
				position:relative;
			}
			.estante {
				position:absolute;
				left:0;
				display:flex;
				width:100%;
			}
			.estante span {
				font-size:2.2vh;
				text-align:center;
				font-family: 'dollop_serifexpanded';
				color:#fff;
				background:#728cab;
				display:block;
				width:20%;
				padding:0.5vh 0;
			}
			.estante span:first-child {
				border-radius: 1vh 0 0 0;
			}
			.estante span:last-child {
				border-radius: 0 1vh 0 0;
			}
			#est01 {
				top:10.6%;
			}
			#est02 {
				top:27.3%;
			}
			#est03 {
				top:44.0%;
			}
			#est04 {
				top:60.6%;
			}
			#est05 {
				top:77.3%;
			}
			#est06 {
				top:94.0%;
			}
			.valija {
				width: 18%;
				position:absolute;
				transition:0.2s;
			}
			.valija.afuera {
				left:-50% !important;
			}
			.valija.centro {
				width: 60%;
				z-index: 2;
				top: 28% !important;
				left: 17% !important;
				transition:0.3s;
			}
			#val01, #val02, #val03, #val04, #val05 {
				top: 0;
			}
			#val06, #val07, #val08, #val09, #val10 {
				top: 17%;
			}
			#val11, #val12, #val13, #val14, #val15 {
				top: 33.5%;
			}
			#val16, #val17, #val18, #val19, #val20 {
				top: 50.3%;
			}
			#val21, #val22, #val23, #val24, #val25 {
				top: 67.0%;
			}
			#val26, #val27, #val28, #val29, #val30 {
				top: 83.6%;
			}
			#val01, #val06, #val11, #val16, #val21, #val26 {
				left:1%;
			}
			#val02, #val07, #val12, #val17, #val22, #val27 {
				left:21%;
			}
			#val03, #val08, #val13, #val18, #val23, #val28 {
				left:41%;
			}
			#val04, #val09, #val14, #val19, #val24, #val29 {
				left:61%;
			}
			#val05, #val10, #val15, #val20, #val25, #val30 {
				left:81%;
			}
			#final, #home {
				background:url('img/fondofin.png') top center no-repeat #F1E3CD;
				background-size: cover;	
				z-index:3;
			}
			#final > div, #home > div {
				width:100%;
				height:100vh;
				display:flex;
				justify-content:space-around;
				align-items: center;
				flex-direction:column;
				padding:12vh 2%;
				box-sizing:border-box;
			}
			#final p, #home p {
				font-size:2.2vh;
				text-align:center;
				font-family: 'dollop_serifcondensed';
				color:#004976;
			}
			#finalimg {
				display:block;
				width:90%;
			}
			#bubuja {
				font-size:2.2vh;
				color:#F1E3CD;
				background:url('img/burbuja.png') top center no-repeat;
				background-size:100% auto;
				width:90%;
				text-align:center;
				height:20%;
				padding-top:5%;
				font-family: 'dollop_serifexpanded';
			}
			#final {
				display:none;
			}
			#home video {
				width: 90%;
				height: auto;
				object-fit: cover;
				display:block;
				margin:auto;
				background: #fff;
			}
		</style>
		<script src="jquery.min.js"></script>
		<script>
		
			function reiniciar() {	
				video.pause();			
				$('.valija').addClass('afuera');
				$('.valija').removeClass('centro');
				//setTimeout(va,1000);
				$('#final').hide();
				$('#home').fadeOut();
				va();
			}
			function va() {
				const porFila = 5;
				const delayItem = 150; // si querés aún más rápido, bajalo a 120 o 100
				const overlap = 3;     // empieza en la 2 (antes era la 3)

				$('.valija').each(function (i) {
					const fila = Math.floor(i / porFila);
					const pos = i % porFila;

					const delay =
						(pos * delayItem) +
						(fila * delayItem * (porFila - overlap));

					setTimeout(() => {
						$(this).removeClass('afuera');
					}, delay);
				});
			}
			function finaliza() {
				$('#final').fadeIn();
			}
			
			$().ready(function() {
				const video = document.getElementById('video');
				$('#logojuego').click(reiniciar);
				$('.valija').click(async function() {
					const indice = $(this).attr('src').replace(/\D/g, '')						
					if (window.pywebview && window.pywebview.api) {
						 const result = await window.pywebview.api.enviar(indice);
						 $('#burbuja').html(result);
					} else {
						console.log("pywebview no disponible, simulo envío:", indice);
					}
					$(this).addClass('centro');
					setTimeout(finaliza,300);
				});
				$('#final').click(function() {
					video.currentTime = 0;
					$('#home').fadeIn(function() {
						video.play();
					});					
				});
				$('#home').click(function() {
					reiniciar();
				});
			});
			function setup() {
				console.log("pywebview listo");

				document.addEventListener("keydown", function (e) {
					if (e.key === "Escape") {
						console.log("ESC presionado");
						window.pywebview.api.cerrar();
					}
				});
			}

			if (window.pywebview) {
				setup();
			} else {
				window.addEventListener('pywebviewready', setup);
			}
		</script>
	</head>
	<body>
		<div id="marco">
			<div id="final" class="pantalla">
				<div>
					<img id="logojuego" src="img/logo.png" />
					<div id="bubuja">¡GENIAL! RETIRÁ TU VALIJA<br/> DEL CONTENEDOR...</div>
					<img id="finalimg" src="img/final.png" />
					<p>¡Etiquetanos con tu premio! @HellmannsArg</p>
				</div>
			</div>
			<div id="juego" class="pantalla">
				<div>
					<img id="logojuego" src="img/logo.png" />
					<p>TOCÁ LA VALIJA QUE MÁS TE GUSTE...<br/>¡Y QUE CAIGA LA SUERTE!</p>
					<div id="estantes">
						<img class="valija" id="val01" src="img/val01.png" />
						<img class="valija" id="val02" src="img/val02.png" />
						<img class="valija" id="val03" src="img/val03.png" />
						<img class="valija" id="val04" src="img/val04.png" />
						<img class="valija" id="val05" src="img/val05.png" />
						<img class="valija" id="val06" src="img/val06.png" />
						<img class="valija" id="val07" src="img/val07.png" />
						<img class="valija" id="val08" src="img/val08.png" />
						<img class="valija" id="val09" src="img/val09.png" />
						<img class="valija" id="val10" src="img/val10.png" />
						<img class="valija" id="val11" src="img/val11.png" />
						<img class="valija" id="val12" src="img/val12.png" />
						<img class="valija" id="val13" src="img/val13.png" />
						<img class="valija" id="val14" src="img/val14.png" />
						<img class="valija" id="val15" src="img/val15.png" />
						<img class="valija" id="val16" src="img/val16.png" />
						<img class="valija" id="val17" src="img/val17.png" />
						<img class="valija" id="val18" src="img/val18.png" />
						<img class="valija" id="val19" src="img/val19.png" />
						<img class="valija" id="val20" src="img/val20.png" />
						<img class="valija" id="val21" src="img/val21.png" />
						<img class="valija" id="val22" src="img/val22.png" />
						<img class="valija" id="val23" src="img/val23.png" />
						<img class="valija" id="val24" src="img/val24.png" />
						<img class="valija" id="val25" src="img/val25.png" />
						<img class="valija" id="val26" src="img/val26.png" />
						<img class="valija" id="val27" src="img/val27.png" />
						<img class="valija" id="val28" src="img/val28.png" />
						<img class="valija" id="val29" src="img/val29.png" />
						<img class="valija" id="val30" src="img/val30.png" />

						<div class="estante" id="est01" />
							<span>1</span>
							<span>2</span>
							<span>3</span>
							<span>4</span>
							<span>5</span>
						</div>
						<div class="estante" id="est02" />
							<span>6</span>
							<span>7</span>
							<span>8</span>
							<span>9</span>
							<span>10</span>
						</div>
						<div class="estante" id="est03" />
							<span>11</span>
							<span>12</span>
							<span>13</span>
							<span>14</span>
							<span>15</span>
						</div>
						<div class="estante" id="est04" />
							<span>16</span>
							<span>17</span>
							<span>18</span>
							<span>19</span>
							<span>20</span>
						</div>
						<div class="estante" id="est05" />
							<span>21</span>
							<span>22</span>
							<span>23</span>
							<span>24</span>
							<span>25</span>
						</div>
						<div class="estante" id="est06" />
							<span>26</span>
							<span>27</span>
							<span>28</span>
							<span>29</span>
							<span>30</span>
						</div>
					</div>
				</div>
			</div>
			<div id="final" class="pantalla">
				<div>
					<img id="logojuego" src="img/logo.png" />
					<div id="bubuja">¡GENIAL! RETIRÁ TU VALIJA<br/> DEL CONTENEDOR...</div>
					<img id="finalimg" src="img/final.png" />
					<p>¡Etiquetanos con tu premio! @HellmannsArg</p>
				</div>
			</div>
			<div id="home" class="pantalla">
				<div>
					<img id="logojuego" src="img/logo.png" />
					<video id="video" autoplay muted loop playsinline>
						<source src="img/home.mp4" type="video/mp4">
					</video>
					<p>Home</p>
				</div>
			</div>
		</div>
	</body>
</html>